const Jimp = require('jimp');
const jsQR = require('jsqr');

const qrCodeBase64 = "data:image/png;base64,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";

// Remove data URL prefix
const base64Data = qrCodeBase64.replace(/^data:image\/\w+;base64,/, '');
const buffer = Buffer.from(base64Data, 'base64');

Jimp.read(buffer)
  .then(image => {
    const imageData = {
      data: new Uint8ClampedArray(image.bitmap.data),
      width: image.bitmap.width,
      height: image.bitmap.height
    };

    const code = jsQR(imageData.data, imageData.width, imageData.height);

    if (code) {
      console.log('QR Code Data:', code.data);
      const qrData = JSON.parse(code.data);
      console.log('\nParsed QR Data:');
      console.log('Type:', qrData.type);
      console.log('URL:', qrData.url);
      console.log('Token:', qrData.token);
      console.log('Invoice Number:', qrData.invoiceNumber);
      console.log('Amount:', qrData.amount);
    } else {
      console.log('No QR code found');
    }
  })
  .catch(err => {
    console.error('Error:', err);
  });
